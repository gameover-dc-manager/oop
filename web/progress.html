<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Music Bot - Real Time Progress</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .music-container {
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
        }
        
        .track-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            transition: transform 0.3s ease;
        }
        
        .track-card:hover {
            transform: translateY(-5px);
        }
        
        .progress-bar-custom {
            height: 8px;
            border-radius: 10px;
            background: #e9ecef;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff6b35, #f7931e);
            border-radius: 10px;
            transition: width 0.3s ease;
        }
        
        .no-track {
            text-align: center;
            color: rgba(255, 255, 255, 0.8);
        }
        
        .header-title {
            color: white;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }
    </style>
</head>
<body>
    <div class="container py-5">
        <div class="row mb-4">
            <div class="col-12 text-center">
                <h1 class="header-title mb-2">
                    <i class="fas fa-music me-3"></i>
                    Music Bot Progress
                </h1>
                <p class="text-white-50">Real-time music playback status</p>
            </div>
        </div>
        
        <div class="music-container p-4">
            <div id="trackInfo" class="no-track">
                <i class="fas fa-music-note fa-3x mb-3"></i>
                <h3>No Track Playing</h3>
                <p>Play something to see real-time progress here</p>
            </div>
        </div>
        
        <div class="row mt-4">
            <div class="col-12 text-center">
                <a href="/captcha" class="btn btn-light me-3">
                    <i class="fas fa-shield-alt me-2"></i>
                    Captcha Dashboard
                </a>
                <button class="btn btn-outline-light" onclick="location.reload()">
                    <i class="fas fa-sync-alt me-2"></i>
                    Refresh
                </button>
            </div>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        async function updateTrackInfo() {
            try {
                const response = await fetch('/api/track');
                const data = await response.json();
                
                const trackInfoDiv = document.getElementById('trackInfo');
                
                if (data && data.status !== 'no_track' && data.title) {
                    // Calculate progress
                    const elapsed = Date.now() - data.startTime;
                    const progress = data.isStream ? 0 : Math.min((elapsed / data.length) * 100, 100);
                    
                    trackInfoDiv.innerHTML = `
                        <div class="track-card p-4">
                            <div class="row align-items-center">
                                <div class="col-md-3 text-center mb-3 mb-md-0">
                                    <img src="${data.thumbnail || '/placeholder-music.jpg'}" 
                                         alt="Track Thumbnail" 
                                         class="img-fluid rounded"
                                         style="max-width: 150px; max-height: 150px;">
                                </div>
                                <div class="col-md-9">
                                    <h4 class="text-primary mb-2">${data.title}</h4>
                                    <p class="text-muted mb-3">by ${data.author}</p>
                                    
                                    ${!data.isStream ? `
                                        <div class="progress-bar-custom mb-2">
                                            <div class="progress-fill" style="width: ${progress}%"></div>
                                        </div>
                                        <div class="d-flex justify-content-between small text-muted">
                                            <span>${formatTime(elapsed)}</span>
                                            <span>${formatTime(data.length)}</span>
                                        </div>
                                    ` : `
                                        <div class="text-center">
                                            <span class="badge bg-danger">ðŸ”´ LIVE STREAM</span>
                                        </div>
                                    `}
                                    
                                    <div class="mt-3">
                                        <span class="badge bg-success">${data.status.toUpperCase()}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                } else {
                    trackInfoDiv.innerHTML = `
                        <div class="no-track">
                            <i class="fas fa-music fa-3x mb-3"></i>
                            <h3>No Track Playing</h3>
                            <p>Play something to see real-time progress here</p>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Failed to fetch track info:', error);
            }
        }
        
        function formatTime(ms) {
            if (!ms || isNaN(ms)) return '0:00';
            const totalSeconds = Math.floor(ms / 1000);
            const minutes = Math.floor(totalSeconds / 60);
            const seconds = totalSeconds % 60;
            return `${minutes}:${seconds.toString().padStart(2, '0')}`;
        }
        
        // Update every 1 second
        updateTrackInfo();
        setInterval(updateTrackInfo, 1000);
    </script>
</body>
</html>